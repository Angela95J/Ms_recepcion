# ğŸ—ï¸ Arquitectura Docker - Microservicio de RecepciÃ³n

## ğŸ“ Diagrama de Arquitectura Completa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DOCKER HOST (Windows/Linux)                       â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    docker-compose.app.yml                            â”‚ â”‚
â”‚  â”‚                   (Stack: RecepciÃ³n de Incidentes)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Red: recepcion-network (bridge)                    â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  Container: recepcion-postgres                              â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  PostgreSQL 15                                     â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Puerto: 5432                                    â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Usuario: postgres                               â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - BD: MSrecepcion                                 â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Health: pg_isready                              â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚           â”‚                                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚           â””â”€â–º Volumen: postgres_data (persistente)          â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                      â–²                                               â”‚ â”‚
â”‚  â”‚                      â”‚ jdbc:postgresql://postgres:5432              â”‚ â”‚
â”‚  â”‚                      â”‚                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  Container: recepcion-microservicio                         â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Spring Boot 3.5.7 (Java 17)                      â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Puerto: 8080                                    â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - API REST                                        â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Swagger UI: /api/swagger-ui.html               â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Health: /api/actuator/health                   â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - JVM: -Xms512m -Xmx1024m                         â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Seguridad: API Keys                            â”‚     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚           â”‚                 â”‚                                â”‚   â”‚ â”‚
â”‚  â”‚  â”‚           â”‚                 â””â”€â–º Volumen: uploads_data        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚           â”‚                     (archivos multimedia)        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚           â”‚                                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚           â””â”€â–º depends_on: postgres, ml-texto, ml-imagen     â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚              â”‚                          â”‚                            â”‚ â”‚
â”‚  â”‚              â”‚ http://ml-texto:8001     â”‚ http://ml-imagen:8002     â”‚ â”‚
â”‚  â”‚              â”‚                          â”‚                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Container:              â”‚  â”‚  Container:                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  recepcion-ml-texto      â”‚  â”‚  recepcion-ml-imagen           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  FastAPI         â”‚    â”‚  â”‚  â”‚  FastAPI              â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Python 3.11     â”‚    â”‚  â”‚  â”‚  Python 3.11          â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Puerto: 8001  â”‚    â”‚  â”‚  â”‚  - Puerto: 8002       â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                  â”‚    â”‚  â”‚  â”‚                       â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Componentes:    â”‚    â”‚  â”‚  â”‚  Componentes:         â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ K-means       â”‚    â”‚  â”‚  â”‚  â€¢ K-means            â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ TF-IDF        â”‚    â”‚  â”‚  â”‚  â€¢ OpenCV             â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ NLTK          â”‚    â”‚  â”‚  â”‚  â€¢ Pillow             â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ scikit-learn  â”‚    â”‚  â”‚  â”‚  â€¢ scikit-learn       â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                  â”‚    â”‚  â”‚  â”‚                       â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Endpoints:      â”‚    â”‚  â”‚  â”‚  Endpoints:           â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ /docs         â”‚    â”‚  â”‚  â”‚  â€¢ /docs              â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ /api/ml/salud â”‚    â”‚  â”‚  â”‚  â€¢ /api/ml/salud      â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ /api/ml/      â”‚    â”‚  â”‚  â”‚  â€¢ /api/ml/           â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    analizar-textoâ”‚    â”‚  â”‚  â”‚    analizar-imagen    â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚         â”‚                 â”‚  â”‚         â”‚                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚         â””â”€â–º VolÃºmenes:    â”‚  â”‚         â””â”€â–º VolÃºmenes:        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚             - trained_    â”‚  â”‚             - trained_        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚               models/     â”‚  â”‚               models/         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚             - data/       â”‚  â”‚             - data/           â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Puertos Expuestos al Host                       â”‚ â”‚
â”‚  â”‚  localhost:5432  â”€â”€â–º postgres:5432       (PostgreSQL)              â”‚ â”‚
â”‚  â”‚  localhost:8080  â”€â”€â–º microservicio:8080  (API REST)                â”‚ â”‚
â”‚  â”‚  localhost:8001  â”€â”€â–º ml-texto:8001       (ML Texto)                â”‚ â”‚
â”‚  â”‚  localhost:8002  â”€â”€â–º ml-imagen:8002      (ML Imagen)               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â–²                    â–²
                            â”‚                    â”‚
                            â”‚                    â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Cliente Web    â”‚  â”‚  Postman/cURL   â”‚
                   â”‚  n8n (futuro)   â”‚  â”‚  Testing        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Procesamiento de Incidentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUJO DE PROCESAMIENTO                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£  Cliente envÃ­a POST /api/incidentes
     â”‚
     â–¼
2ï¸âƒ£  Microservicio (Puerto 8080)
     â”‚
     â”œâ”€â–º Valida datos
     â”œâ”€â–º Guarda en PostgreSQL (incidente, solicitante, ubicaciÃ³n)
     â”œâ”€â–º Retorna respuesta inmediata (estado: PENDIENTE)
     â”‚
     â””â”€â–º Lanza anÃ¡lisis ASÃNCRONO (@Async)
         â”‚
         â–¼
3ï¸âƒ£  AnalisisMlOrchestrationService
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                         â”‚                        â”‚
     â–¼                         â–¼                        â–¼
4ï¸âƒ£  MlTextoClient          (Espera)              (Futuro: imagen)
     â”‚
     POST http://ml-texto:8001/api/ml/analizar-texto
     â”‚
     â–¼
5ï¸âƒ£  ML Texto Service (Puerto 8001)
     â”‚
     â”œâ”€â–º Preprocesa texto (NLTK)
     â”œâ”€â–º Vectoriza (TF-IDF)
     â”œâ”€â–º Clasifica (K-means)
     â”œâ”€â–º Extrae keywords
     â”œâ”€â–º Calcula score de confianza
     â”‚
     â””â”€â–º Retorna JSON con anÃ¡lisis
         â”‚
         â–¼
6ï¸âƒ£  Microservicio guarda anÃ¡lisis
     â”‚
     â”œâ”€â–º Crea registro en analisis_ml_texto
     â”œâ”€â–º Actualiza incidente:
     â”‚   - estado: ANALIZADO
     â”‚   - prioridadTexto: 1-5
     â”‚   - prioridadFinal: valor calculado
     â”‚
     â””â”€â–º Listo âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

7ï¸âƒ£  Cliente sube imagen POST /api/multimedia/{id}/imagenes
     â”‚
     â–¼
8ï¸âƒ£  Microservicio
     â”‚
     â”œâ”€â–º Guarda archivo en volumen uploads_data
     â”œâ”€â–º Registra en BD (tabla multimedia)
     â”œâ”€â–º Retorna respuesta inmediata
     â”‚
     â””â”€â–º Lanza anÃ¡lisis ASÃNCRONO de imagen
         â”‚
         â–¼
9ï¸âƒ£  MlImagenClient
     â”‚
     POST http://ml-imagen:8002/api/ml/analizar-imagen
     â”‚
     â–¼
ğŸ”Ÿ  ML Imagen Service (Puerto 8002)
     â”‚
     â”œâ”€â–º Carga imagen (OpenCV)
     â”œâ”€â–º Extrae features
     â”œâ”€â–º Clasifica severidad (K-means)
     â”œâ”€â–º Detecta objetos
     â”œâ”€â–º EvalÃºa veracidad
     â”‚
     â””â”€â–º Retorna JSON con anÃ¡lisis
         â”‚
         â–¼
1ï¸âƒ£1ï¸âƒ£  Microservicio guarda anÃ¡lisis
     â”‚
     â”œâ”€â–º Crea registro en analisis_ml_imagen
     â”œâ”€â–º Actualiza incidente:
     â”‚   - prioridadImagen: 1-5
     â”‚   - scoreVeracidad: 0-1
     â”‚   - prioridadFinal: (texto*0.6 + imagen*0.4)
     â”‚
     â””â”€â–º Listo âœ…
```

---

## ğŸ” Arquitectura de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CAPAS DE SEGURIDAD                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Nivel 1: Red Docker Aislada
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  recepcion-network (bridge)                  â”‚
â”‚  â€¢ Solo servicios autorizados                â”‚
â”‚  â€¢ No acceso directo desde internet          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Nivel 2: AutenticaciÃ³n (Microservicio)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SecurityConfigSimple                        â”‚
â”‚  â€¢ Header: X-API-Key                         â”‚
â”‚  â€¢ Lista de keys en .env                     â”‚
â”‚  â€¢ Todas las rutas protegidas                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Nivel 3: Usuarios No-Root
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ ML Texto: mluser (uid 1000)               â”‚
â”‚  â€¢ ML Imagen: mluser (uid 1000)              â”‚
â”‚  â€¢ Microservicio: spring user                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Nivel 4: Variables de Entorno
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ .env ignorado en git                      â”‚
â”‚  â€¢ ContraseÃ±as no hardcodeadas               â”‚
â”‚  â€¢ .env.example como template                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Nivel 5: VolÃºmenes con Permisos
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ postgres_data: solo postgres              â”‚
â”‚  â€¢ uploads_data: solo microservicio          â”‚
â”‚  â€¢ trained_models: read-only para servicios  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Arquitectura de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PERSISTENCIA DE DATOS                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Docker Volumes (Persistentes)
â”‚
â”œâ”€â–º postgres_data (Driver: local)
â”‚   â”‚
â”‚   â””â”€â–º /var/lib/postgresql/data/pgdata
â”‚       â”‚
â”‚       â”œâ”€â–º Tablas:
â”‚       â”‚   - incidente
â”‚       â”‚   - solicitante
â”‚       â”‚   - ubicacion
â”‚       â”‚   - multimedia
â”‚       â”‚   - analisis_ml_texto
â”‚       â”‚   - analisis_ml_imagen
â”‚       â”‚   - incidente_historial_estados
â”‚       â”‚
â”‚       â””â”€â–º Ãndices, Constraints, Sequences
â”‚
â”œâ”€â–º uploads_data (Driver: local)
â”‚   â”‚
â”‚   â””â”€â–º /app/uploads/
â”‚       â”‚
â”‚       â”œâ”€â–º incidentes/
â”‚       â”‚   â”œâ”€â–º {incidente_id}/
â”‚       â”‚   â”‚   â”œâ”€â–º imagenes/
â”‚       â”‚   â”‚   â”‚   â”œâ”€â–º {timestamp}_{filename}.jpg
â”‚       â”‚   â”‚   â”‚   â””â”€â–º ...
â”‚       â”‚   â”‚   â””â”€â–º videos/
â”‚       â”‚   â”‚       â””â”€â–º ...
â”‚       â”‚   â””â”€â–º ...
â”‚       â”‚
â”‚       â””â”€â–º temp/
â”‚
â””â”€â–º Bind Mounts (Compartidos con host)
    â”‚
    â”œâ”€â–º ml_analisis_texto/trained_models/
    â”‚   â”œâ”€â–º kmeans_model.pkl
    â”‚   â”œâ”€â–º tfidf_vectorizer.pkl
    â”‚   â””â”€â–º label_encoder.pkl
    â”‚
    â””â”€â–º ml_analisis_imagen/trained_models/
        â”œâ”€â–º kmeans_image_model.pkl
        â””â”€â–º scaler.pkl
```

---

## âš™ï¸ ConfiguraciÃ³n de Servicios

### PostgreSQL
```yaml
Imagen: postgres:15-alpine
Puerto: 5432
Variables:
  - POSTGRES_DB=MSrecepcion
  - POSTGRES_USER=postgres
  - POSTGRES_PASSWORD=******
Volumen: postgres_data
Health Check: pg_isready
Restart: unless-stopped
```

### Microservicio (Spring Boot)
```yaml
Build: recepcion/Dockerfile (multi-stage)
Puerto: 8080
Variables:
  - SPRING_DATASOURCE_URL
  - ML_TEXTO_BASE_URL=http://ml-texto:8001
  - ML_IMAGEN_BASE_URL=http://ml-imagen:8002
  - JAVA_OPTS=-Xms512m -Xmx1024m
Volumen: uploads_data
Depends On: postgres, ml-texto, ml-imagen
Health Check: /api/actuator/health
Restart: unless-stopped
```

### ML Texto
```yaml
Build: ml_analisis_texto/Dockerfile
Puerto: 8001
Variables:
  - MODEL_PATH=/app/trained_models
  - PYTHONUNBUFFERED=1
VolÃºmenes:
  - trained_models (bind)
  - data (bind)
Health Check: /api/ml/salud
Restart: unless-stopped
```

### ML Imagen
```yaml
Build: ml_analisis_imagen/Dockerfile
Puerto: 8002
Variables:
  - MODEL_PATH=/app/trained_models
  - PYTHONUNBUFFERED=1
VolÃºmenes:
  - trained_models (bind)
  - data (bind)
Health Check: /api/ml/salud
Restart: unless-stopped
```

---

## ğŸš€ Orden de Inicio

```
1. Red Docker se crea
   â””â”€â–º recepcion-network

2. VolÃºmenes se crean
   â”œâ”€â–º postgres_data
   â””â”€â–º uploads_data

3. PostgreSQL inicia
   â””â”€â–º Espera health check (pg_isready)

4. Servicios ML inician (en paralelo)
   â”œâ”€â–º ML Texto
   â”‚   â””â”€â–º Carga modelos NLTK
   â”‚   â””â”€â–º Espera health check
   â””â”€â–º ML Imagen
       â””â”€â–º Carga modelos OpenCV
       â””â”€â–º Espera health check

5. Microservicio inicia
   â””â”€â–º Espera depends_on (postgres, ml-texto, ml-imagen)
   â””â”€â–º Conecta a PostgreSQL
   â””â”€â–º Valida esquema (ddl-auto: validate)
   â””â”€â–º Espera health check
   â””â”€â–º Listo para recibir requests âœ…
```

---

## ğŸ“ˆ Escalabilidad Futura

### Horizontal Scaling (con Docker Swarm/Kubernetes)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Balancer (nginx/traefik)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚           â”‚
    â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Micro  â”‚  â”‚ Micro  â”‚  â”‚ Micro  â”‚
â”‚ serv 1 â”‚  â”‚ serv 2 â”‚  â”‚ serv 3 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PostgreSQL   â”‚
        â”‚  (Replicado)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Ãšltima actualizaciÃ³n:** 2025-01-07
